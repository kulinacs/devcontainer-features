# DevContainer Features

This document provides instructions for AI agents contributing to this repository. The primary objective is to maintain and expand the collection of high-quality DevContainer features.

## Project Structure

- `src/`: Contains feature definitions.
  - `src/<feature-id>/devcontainer-feature.json`: Feature metadata and configuration.
  - `src/<feature-id>/install.sh`: Bash script to install the tool.
  - `src/<feature-id>/README.md`: Feature documentation (autogenerated/updated).
- `test/`: Contains feature tests.
  - `test/<feature-id>/test.sh`: Scenario-based tests for the feature.
- `.github/workflows/`: GitHub Actions for validation and testing.

## Workflow for Adding/Updating Features

When tasked with adding a new tool as a DevContainer feature:

1.  **Create the Feature Directory**: `src/<new-feature-id>`.
2.  **Define `devcontainer-feature.json`**:
    - Follow the [DevContainer Feature Schema](https://github.com/devcontainers/spec/blob/main/proposals/devcontainer-feature.json).
    - Ensure `id`, `version`, `name`, and `description` are clear.
    - **Proactive Instruction**: Add VS Code customizations to inform AI assistants about the tool:
      ```json
      "customizations": {
          "vscode": {
              "settings": {
                  "github.copilot.chat.codeGeneration.instructions": [
                      { "text": "This dev container includes <Name> (<binary>) pre-installed and available on the PATH." }
                  ]
              }
          }
      }
      ```
3.  **Implement `install.sh`**:
    - Ensure the script is idempotent and uses `set -e` for error handling.
    - Prioritize official installation methods (e.g., `apt`, `npm`, or direct binary downloads).
    - Clean up temporary files and caches to keep image sizes small.
4.  **Add Tests**:
    - Create `test/<new-feature-id>/test.sh`.
    - Use the `dev-container-features-test-lib` for assertions.
    - Ensure the tool is verified in multiple base images (Debian, Ubuntu) as per the CI matrix in `test.yaml`.

## Quality Standards

- **Metadata Consistency**: The `id` in `devcontainer-feature.json` must match the directory name.
- **Documentation**: Update the root `README.md` feature table when adding a new feature.
- **Validation**:
  - Run `devcontainer features test -f <feature-id> .` locally if the CLI is available.
  - Ensure `devcontainer-feature.json` is valid against the specification.
- **SemVer**: Increment the `version` in `devcontainer-feature.json` for any changes to the feature implementation.

## CI/CD Awareness

- **`validate.yaml`**: Automatically checks the validity of JSON configurations on pull requests.
- **`test.yaml`**: Runs tests across multiple base images. Agents should prioritize fixing test failures in these environments.
- **`release.yaml`**: Handles the publishing of features to GHCR. Do not manually trigger releases.
